<div class="course-curriculam-accodion mt-30">
  <div class="accordion" id="accordionExample">
    <mat-accordion>
      <ng-container *ngFor="let module of course?.modules; let i = index;">
        <mat-expansion-panel [expanded]="i === 0">
          <mat-expansion-panel-header>
            <mat-panel-title>
        <span class="accordion-header mt-3">
          <span class="accordion-tittle mt-5 mb-5">
            <span *ngIf="!isEditMode || editingModuleIndex !== i">{{module.name}}</span>
            <mat-form-field appearance="fill" *ngIf="isEditMode && editingModuleIndex === i">

            <input type="text" [value]="module.name" [(ngModel)]="newName"
                   (keydown.space)="onSpaceKeydown($event)"
                   (focusout)="onInputFocusOut()"
                   (keyup)="updateName($event, i)" placeholder="edit module name">
            </mat-form-field>

          </span>
          <span class="accordion-tittle-inner" >
            <span>{{module.videos.length}} tutorials • {{module.labs.length}} labs • {{module.quizzes.length}} Quiz</span>&nbsp;
            <button style="color: #0b7ef1 " *ngIf="!isEditMode && user == teacher_id" (click)="addVideo(courseId,module.id,module.name)"><i class="fas fa-file-video "></i></button>
            <button style="color: #f1840b " *ngIf="!isEditMode && user == teacher_id" (click)="addLab(courseId,module.id,module.name)"><i class="fas fa-file-code"></i></button>
            <button style="color: #484747 " *ngIf="!isEditMode && user == teacher_id" (click)="addQuizz(courseId,module.id,module.name)"><i class="fas fa-question-circle"></i></button>
            <button style="color: #078f28" *ngIf="(!isEditMode || editingModuleIndex !== i) && user == teacher_id" (click)="editName(i)"><i class="fas fa-edit"></i></button>
            <button style="color: #d00e32 " *ngIf="!isEditMode && user == teacher_id" (click)="deleteModule(courseId,module.id,module.name)" ><i class="fas fa-trash "></i></button>
          </span>

        </span>
            </mat-panel-title>

          </mat-expansion-panel-header>
          <div id="collapseOne" class="accordion-collapse collapse show mt-2"
               aria-labelledby="headingOne" data-bs-parent="#accordionExample"
               *ngFor="let video of module.videos; let j = index">
            <div class="enrolled"
                 *ngIf="(is_enrolled || role ==='Super_Admin' || ( role ==='Teacher' && user === teacher_id) || ( role ==='Student_Teacher' && user === teacher_id)) || course.status==='pending'"
                 >
              <div class="course-curriculum-content d-sm-flex justify-content-between align-items-center">
                <div class="course-curriculum-info">
                  <i class="flaticon-youtube"></i>

                  <h4>{{video.name}}</h4>
                </div>
                <div class="course-curriculum-meta" >
                  <span>{{video.duration}}</span>
                  <button style="color: #078f28" *ngIf="user == teacher_id" (click)="editVideo(courseId,module.id,video.id,video)"><i class="fas fa-edit"></i></button>
                  <button style="color: #d00e32 " *ngIf="user == teacher_id"  (click)="deleteVideo(courseId,module.id,video.id,module.name,video.name)" ><i class="fas fa-trash "></i></button>


                </div>
              </div>
            </div>
            <div class="accordion-body"
                 *ngIf="!is_enrolled && role !=='Super_Admin' && user != teacher_id && course.status==='approved'">
              <div class="course-curriculum-content d-sm-flex justify-content-between align-items-center">
                <div class="course-curriculum-info">
                  <i class="flaticon-youtube"></i>

                  <h4>{{video.name}}</h4>
                </div>
                <div class="course-curriculum-meta">
                  <span>{{video.duration}}</span>
                  <span class="time"> <i class="flaticon-lock"></i></span>
                </div>

              </div>
            </div>
          </div>
          <div  class="accordion-collapse collapse show mt-2"
               aria-labelledby="headingOne" data-bs-parent="#accordionExample"
               *ngFor="let quizz of module.quizzes; let j = index">
            <div class="enrolled"
                 *ngIf="(is_enrolled || role ==='Super_Admin' || ( role ==='Teacher' && user === teacher_id) || ( role ==='Student_Teacher' && user === teacher_id)) || course.status==='pending'"
                 >
              <div class="course-curriculum-content d-sm-flex justify-content-between align-items-center">
                <div class="course-curriculum-info" >
                  <i class="fas fa-question-circle"></i>

                  <h4>Quiz : {{quizz.name}}</h4>
                </div>
                <div class="course-curriculum-meta" >
                  <div >
                    <ng-container *ngIf="getQuizPercentage(quizz.id) | async as percentage">
                      <h6 class="text-center">{{ percentage }}%</h6>
                      <ngx-gauge [value]="percentage" [size]="30" [type]="'full'" [thick]="4" class="guage-chart-center text-white"></ngx-gauge>
                    </ng-container>
                  </div>
                  <button style="color: #078f28" *ngIf="user == teacher_id" (click)="editQuizz(quizz.id,module.id,module.name,quizz.name,quizz)"><i class="fas fa-edit"></i></button>
                  <button style="color: #d00e32 " *ngIf="user == teacher_id" (click)="deleteQuizz(module.id,quizz.id,module.name,quizz.name)"><i class="fas fa-trash "></i></button>

                </div>
              </div>
            </div>
            <div class="accordion-body"
                 *ngIf="!is_enrolled && role !=='Super_Admin' && user != teacher_id && course.status==='approved'">
              <div class="course-curriculum-content d-sm-flex justify-content-between align-items-center">
                <div class="course-curriculum-info">
                  <i class="fas fa-question-circle"></i>

                  <h4>{{quizz.name}}</h4>
                </div>
                <div class="course-curriculum-meta">
<!--                  <span>{{video.duration}}</span>-->
                  <span class="time"> <i class="flaticon-lock"></i></span>
                </div>

              </div>
            </div>
          </div>

          <mat-accordion>
            <ng-container *ngFor="let lab of module.labs">

              <mat-expansion-panel>
                <mat-expansion-panel-header>
                  <mat-panel-title>
                    <div class="course-curriculum-content d-sm-flex justify-content-between align-items-center">
                      <div class="course-curriculum-info">
                        <i class="fas fa-file-code"></i>
                        <h4>{{lab.title}}</h4>
                      </div>
                    </div>
                  </mat-panel-title>
                </mat-expansion-panel-header>
               <app-lab-component *ngIf="role !=='Student'" [lab]="lab" [user]="this.user" [module]="module" [course]="course" [courseId]="courseId" [teacher_id]="teacher_id"></app-lab-component>
              </mat-expansion-panel>
            </ng-container>

          </mat-accordion>

        </mat-expansion-panel>
      </ng-container>
      <ng-container>

        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>
             <span class="accordion-header">
                        <span class="accordion-tittle">
                            <span>Download Course resources</span>
                        </span>
                        <span class="accordion-tittle-inner">
                        </span>
             </span>
            </mat-panel-title>

          </mat-expansion-panel-header>
          <div class=" row mt-3">
            <div class="col-xl-11 col-lg-11 col-md-11 col-sm-11"> <span class="lab_note">Please
              download and review the course <b>slides </b>as they cover important tips and information that are presented throughout the course.
              The slides will be particularly helpful to get reference, so don't miss out on this valuable resource. </span>.
            </div>

            <div class="course-curriculum-meta col-xl-1 col-lg-1 col-md-1 col-sm-1">
              <a href="{{course?.slides}}" class="download-button"><i class="fas fa-download"></i></a>
            </div>
          </div>

        </mat-expansion-panel>
      </ng-container>

    </mat-accordion>

  </div>
</div>
